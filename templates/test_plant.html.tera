<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- The title is dynamically generated by the backend template engine. -->
    <title>{{ title }} - {{ plant }}</title>

    <!-- External Libraries: D3.js for data visualization. -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- External Fonts: Google Fonts for typography. -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Gudea:ital,wght@0,400;0,700;1,400&family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Mulish:ital,wght@0,200..1000;1,200..1000&display=swap"
      rel="stylesheet"
    />

    <!-- Application Stylesheets -->
    <link rel="stylesheet" href="/static/styles/chart.css" />
    <link rel="stylesheet" href="/static/styles/layout.css" />
  </head>
  <body>
    <!-- Main container for the entire application interface. -->
    <main>
      <!-- Page Header: Contains the main title and last updated timestamp. -->
      <header>
        <div>
          <h1>{{ title }} Test Results on {{ plant }}</h1>
        </div>
        <div>
          <!-- This paragraph is populated by script.js with the latest data timestamp. -->
          <p id="lastUpdated"></p>
        </div>
      </header>

      <!-- Filter Controls Section: User inputs for manipulating the chart view. -->
      <section class="filter-controls">
        <!-- Filter by Scale Factor -->
        <div class="filter-group">
          <label for="chooseScale" class="form-label">Scale Factor</label>
          <select
            id="chooseScale"
            name="chooseScale"
            class="form-select"
          ></select>
        </div>

        <!-- Filter by Branch: Includes a dropdown with checkbox list. -->
        <div class="filter-group branch-filter">
          <label for="branch-select-button" class="form-label"
            >Choose Branches</label
          >
          <button id="branch-select-button">Select Branches</button>
          <!-- The dropdown container is toggled by the button above. -->
          <div id="branch-filter-dropdown">
            <div class="branch-filter-actions">
              <button id="branch-select-all">Select All</button>
              <button id="branch-deselect-all">Deselect All</button>
            </div>
            <!-- The list of branches is dynamically generated here by script.js. -->
            <div id="branch-list-container"></div>
          </div>
        </div>

        <!-- Y-Axis Mode Toggle: Switches between a zero-based or adaptive Y-axis. -->
        <div class="filter-group">
          <label class="form-label">Y-Axis Mode</label>
          <fieldset class="y-axis-toggle-fieldset">
            <div class="y-axis-toggle-container">
              <input
                type="radio"
                id="mode-zero"
                name="y_axis_mode"
                value="zero"
                checked
              />
              <label for="mode-zero">From 0</label>
              <input
                type="radio"
                id="mode-zoom"
                name="y_axis_mode"
                value="zoom"
              />
              <label for="mode-zoom">Zoomed</label>
            </div>
          </fieldset>
        </div>
      </section>

      <!-- Chart Area: The SVG element that D3.js will use to render the visualization. -->
      <svg id="chart-svg" style="background-color: #f3f4f669"></svg>

      <!-- Legend Area: Container for the chart legend, populated by D3.js. -->
      <div id="legend-container" class="legend-container"></div>

      <!-- Footer: Contains instructions on how to interact with the chart. -->
      <footer>
        <h3>Chart Controls</h3>
        <ul>
          <li>
            <strong>Zoom:</strong> To inspect a specific time range, use one of
            two methods:
            <ul>
              <li>
                Click and drag horizontally across the
                <span>lower context chart</span>.
              </li>
              <li>
                Click and drag horizontally directly on the
                <span>main chart</span>.
              </li>
            </ul>
          </li>
          <li>
            <strong>Inspect Data:</strong> Hover over any data point on the main
            chart to view detailed information for that specific test run.
          </li>
          <li>
            <strong>Pan:</strong> Once zoomed in, pan the view left or right
            using the <kbd>Arrow Keys</kbd>.
          </li>
          <li>
            <strong>Reset View:</strong> To return to the full time range,
            double-click anywhere on the main chart or press the
            <kbd>Esc</kbd> key.
          </li>
        </ul>
      </footer>

      <!-- Tooltip Element: Hidden by default, its content and position are managed by script.js on hover. -->
      <div class="tooltip"></div>
    </main>
  </body>

  <!-- Scripting Section -->
  <script>
    // Injects the raw chart data from the backend template into a global JavaScript variable.
    // The `json_encode` filter ensures it's a valid JS object, and `safe` prevents HTML escaping.
    const RESULTS_DATA = {{ scales | json_encode(pretty=false) | safe }};
  </script>
  <!-- Main Application Logic: This script handles all data processing and chart rendering. -->
  <script src="/static/scripts/script.js"></script>
</html>
